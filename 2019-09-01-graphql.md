# GraphQL 경험담

처음으로 GraphQL을 프로젝트에 적용해본 것은 2018년 여름 즈음에 했던 외주 프로젝트에서였다. 운좋게도 기술 측면에서의 요구사항이 전무하다시피한 클라이언트를 만나서 써보고 싶은 기술을 전부 써볼 수 있는 기회였다.

GraphQL 스키마와 리졸버를 만드는 일은 즐거웠다. 리졸버를 제대로 작성하기만 하면 GraphQL의 강력하고 유연한 쿼리 기능을 쉽게 얻을 수 있으니, 남는 장사를 하는 느낌이었다. 하지만 급하게 하느라 RDBMS의 조인을 제대로 쓰지 못해서 드는 약간의 불안감은 있었다. (GraphQL은 엔티티 단위로 리졸버를 만드는데, 쿼리에서 어떤 식으로 하위 엔티티를 가져올지를 미리 분석해서 조인을 적용할 수도 있을 것 같았지만 시간이 부족해서 여기까지 건드리지는 못했다.)

GraphiQL 개발 도구도 훌륭했다. 자동 완성 + 자동 문서화는 별 것 아닌 것 같지만 개발할 때의 인지적 부담을 확실히 줄여준다. API 문서 뒤져가며 Postman에서 일일이 쿼리스트링 + 바디를 타이핑해 쳐넣는 것보다 확실히 클라이언트 개발 속도가 빨라지고 투명해지는 느낌이다. 서버와 클라이언트 포지션이 나뉘어져 있는 경우에도 협업할 때에 굉장히 도움이 될 것 같다.

Apollo Client는 환상적이었다. 정규화된 캐시 기능이 공짜였고, 덕분에 낙관적 업데이트를 아주 손쉽게 구현할 수 있었다. 다만 내부가 어떻게 돌아가는지까지 파악하는데 시간이 좀 걸리긴 했다. 프로젝트에 적용해보지는 못했지만, GraphQL 스키마로부터 TypeScript 타입 선언을 자동 생성해주는 툴도 있었다. GraphQL 스키마에 타입 정보가 모두 명시되어 있기 때문에 생기는 장점들인데, RESTful API로 클라이언트를 구현할 때에는 상상도 해보지 못한 기능들이었다.

---

내 마음대로 해도 되는 경우라면, 그리고 GraphQL과 RESTful API 중 어느것을 써도 상관없는 경우라면 앞으로는 무조건 GraphQL을 택할 것 같다. 하지만 다른 개발자들과 GraphQL에 대해 이야기해보면, 아직까지 편하게 GraphQL을 받아들이는 개발자의 비율은 극히 적은 것 같다.

일단 생각보다 GraphQL의 러닝 커브가 완만한 편이 아니다. 일단 GraphQL 스키마 정의와 쿼리 언어를 별도로 배워야 하고, RESTful API를 쓸 때와는 꽤나 다른 멘탈 모델을 갖추어야 하기 때문이다. 서버 개발자의 입장에서 보면, HTTP 요청 단위로 액세스 로그를 남기던 것을 어떻게 남겨야 할 지 애매해지고 (같은 이유로 캐싱 역시 애매해짐) 리졸버 단위로 RDBMS에 쿼리를 날려야 하는데 이러면 조인을 걸기가 애매해지고... 클라이언트 개발자의 입장에서 보면 사실상의 표준이 된 Apollo Client의 동작방식을 이해해야 하는 부담이 있다.

---

그럼에도 불구하고 GraphQL이 RESTful API보다 '서술적이고 정형화된 통신'이라는 문제를 더 잘 해결하고 있는 것은 명확하다. GraphQL 스키마에는 타입 이외에도 (custom directive를 통해) 많은 정보를 담을 수 있어서, 이런 특징을 바탕으로 GraphQL 스키마로부터 백엔드 API를 만들어내는 기술들도 생겨나고 있다. (Prisma, AWS AppSync 등) 개인적으로는 이런 방식에 큰 기대를 걸고 있고, 앞으로 사이드 프로젝트를 할 때 주로 AWS AppSync를 백엔드로 사용해 볼 작정이다.